{% extends '../base.html' %}

{% block title %}Playlists{% endblock %}

{% block content %}
<div class="container">
    <h1>{{ user.username }}'s Playlists</h1>

    <!-- Button to Open the Modal -->
    <button onclick="openModal()" class="btn-create-playlist">Create New Playlist</button>


    <!-- Modal for Creating a Playlist -->
    <div id="createPlaylistModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Create New Playlist</h2>
            <form id="createPlaylistForm" method="post" action="{% url 'create_playlist' %}">
                {% csrf_token %}
                <label for="name">Playlist Name:</label>
                <input type="text" id="name" name="name" required class="form-control"><br><br>
                <label for="description">Description:</label>
                <textarea id="description" name="description" rows="4" class="form-control"></textarea><br><br>
                <button type="submit" class="btn-submit">Create Playlist</button>
            </form>
        </div>
    </div>

    {% if playlists %}
    {% for playlist in playlists %}
    <div class="playlist">
        <h2>{{ playlist.name }}</h2>
        <p>Created on: {{ playlist.created_at|date:"F j, Y" }}</p>

        <!-- Link to view songs in a playlist -->
        <a href="{% url 'view_playlist_songs' user.username playlist.pk %}">View Songs</a>

        {% if playlist.playlistsong_set.exists %}
            <h3>Songs in this playlist:</h3>
            <ul>
                {% for playlist_song in playlist.playlistsong_set.all %}
                    <li>
                        {{ playlist_song.song.title }} by {{ playlist_song.song.user.username }}
                        {% if playlist_song.song.mp3_file %}
                            - <a href="#" onclick="playAudio('{{ playlist_song.song.mp3_file.url }}'); return false;">Listen</a>
                        {% else %}
                            - No audio file available
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No songs in this playlist yet.</p>
        {% endif %}

        <!-- Form to Delete Playlist -->
        <form method="post" action="{% url 'delete_playlist' playlist.pk %}">
            {% csrf_token %}
            <button type="submit" class="btn-delete" onclick="return confirm('Are you sure you want to delete this playlist?');">Delete Playlist</button>
        </form>
    </div>
    <hr>
    {% endfor %}
{% else %}
    <p>No current playlists available.</p>
{% endif %}

<!-- Modal CSS -->
<style>
    /* The Modal (background) */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
    }

    /* Modal Content */
    .modal-content {
        background-color: #fefefe;
        margin: 10% auto; /* 10% from the top and centered */
        padding: 20px;
        border: 1px solid #888;
        width: 50%; /* Could be more or less, depending on screen size */
    }

    /* The Close Button */
    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }
</style>

<!-- Add JavaScript for Modal -->
<script>
    function openModal() {
        document.getElementById('createPlaylistModal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('createPlaylistModal').style.display = 'none';
    }

    // Close modal if clicked outside of the modal content
    window.onclick = function(event) {
        const modal = document.getElementById('createPlaylistModal');
        if (event.target == modal) {
            closeModal();
        }
    }
</script>

{% endblock %}
