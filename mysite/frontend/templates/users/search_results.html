{% extends '../base.html' %}

{% block title %}Search Results{% endblock %}

{% block content %}
<div class="container">
    <h1>Search Results for "{{ query }}"</h1>

    {% if singles.exists %}
    <h2>Songs</h2>
    <ul>
        {% for single in singles %}
            <li>
                <div class="song-details">
                    <span>
                        <a href="#" onclick="playAudio('{{ single.mp3_file.url }}'); return false;">{{ single.title }}</a> 
                        - <a href="{% url 'profile' single.user.username %}" class="nav-link">{{ single.user.username }}</a>
                    </span>

                    <!-- Like/Unlike Heart Icon -->
                    <form method="post" action="{% url 'toggle_like_song' single.pk %}" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="like-button" style="background: none; border: none;">
                            {% if request.user in single.liked_by.all %}
                                <span style="color: red;">&#9829;</span> <!-- Filled heart -->
                            {% else %}
                                <span style="color: grey;">&#9825;</span> <!-- Empty heart -->
                            {% endif %}
                        </button>
                    </form>
                    

                    <!-- Report Button -->
                    <form method="post" action="{% url 'report_song' single.pk %}" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="song_id" value="{{ single.pk }}">
                        <button type="submit" class="btn-report">Report</button>
                    </form>
                </div>

                <!-- Inline dropdown form to add to playlist -->
                <form method="post" action="{% url 'add_to_playlist' %}">
                    {% csrf_token %}
                    <select name="playlist" id="playlist-{{ single.pk }}" required>
                        <option value="" disabled selected>Select a Playlist</option>
                        {% for playlist in playlists %}
                            <option value="{{ playlist.pk }}">{{ playlist.name }}</option>
                        {% endfor %}
                    </select>
                    <input type="hidden" name="song_id" value="{{ single.pk }}">

                    <button type="submit" class="btn-submit">Add to Playlist</button>
                </form>
            </li>
        {% endfor %}
    </ul>
{% endif %}


    {% if users.exists %}
        <h2>Artists</h2>
        <ul>
            {% for user in users %}
                <li>
                    <a href="{% url 'profile' user.username %}" class="nav-link">{{ user.username }}</a>
                </li>
            {% endfor %}
        </ul>
    {% endif %}

    {% if albums.exists %}
        <h2>Albums</h2>
        <ul>
            {% for album in albums %}
                <li><a href="#" class="nav-link">{{ album.title }}</a></li>
            {% endfor %}
        </ul>
    {% endif %}
</div>
{% endblock %}
