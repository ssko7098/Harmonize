{% extends '../base.html' %}

{% load static %}

{% block title %}Search Results{% endblock %}

{% block content %}
<div class="container-alt">
    <h2>Search Results for "{{ query }}"</h2>

    <div class="songs-list">
    {% if singles.exists %}
    <h4>Singles</h4>
    <ul>
        {% for single in singles %}
            <li>
                <div class="song-details">
                    <div class="topbar">
                        <div class="cover-art-title">
                            <span>
                                <a href="#" onclick="playAudio('{{ single.mp3_file.url }}'); return false;">{{ single.title }}</a> 
                                <a href="{% url 'profile' single.user.username %}" class="nav-link">{{ single.user.username }}</a>
                            </span>
                        </div>

                        
                        <div class="like-song-button-container">
                            <!-- Add to Liked Songs Button -->
                            <form method="post" action="{% url 'add_to_liked_songs' single.pk %}">
                                {% csrf_token %}
                                <div class="liked-song-button">
                                    <button type="submit" class="btn-submit" style=" padding: 5px 15px; background-color: #28a745; color: white; border: none; border-radius: 5px;">
                                        Add to Liked Songs
                                    </button>
                                </div>
                            </form>
                        </div>

                        <div class="report-button-container">
                            {% if request.user != single.user %}
                            <!-- Report Button -->
                            <form method="post" action="{% url 'report_song' single.pk %}" style="display:inline;">
                                {% csrf_token %}
                                <input type="hidden" name="song_id" value="{{ single.pk }}">
                                <button type="submit" class="btn-report">Report</button>
                            </form>
                            {% endif %}
                        </div>
                    </div>

                    <div class="add-to-playlist-container">
                        <!-- Inline dropdown form to add to playlist -->
                        <form method="post" action="{% url 'add_to_playlist' %}">
                            {% csrf_token %}
                            <select name="playlist" id="playlist-{{ single.pk }}" required>
                                <option value="" disabled selected>Select a Playlist</option>
                                {% for playlist in playlists %}
                                    <option value="{{ playlist.pk }}">{{ playlist.name }}</option>
                                {% endfor %}
                            </select>
                            <input type="hidden" name="song_id" value="{{ single.pk }}">

                            <button type="submit" class="btn-submit">Add to Playlist</button>
                        </form>
                    </div>
                </div>
            </li>
        {% endfor %}
    </ul>
    {% endif %}
    </div>

    <div class="users-list">
        {% if users.exists %}
            <h4>Artists</h4>
            <ul>
                {% for user in users %}
                    <li>
                        <a href="{% url 'profile' user.username %}" class="nav-link">{{ user.username }}</a>
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>

    <div class="albums-list">
        {% if albums.exists %}
            <h4>Albums</h4>
            <ul>
                {% for album in albums %}
                    <li><a href="#" class="nav-link">{{ album.title }}</a></li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>


    {% if messages %}
    <ul class="messages">
        {% for message in messages %}
            <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}
</div>

{% endblock %}